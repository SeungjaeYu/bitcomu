<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.bitcomu.repository.dao.OnlineclsDAO">

<!-- 온라인강의 맵 resultMap -->
<resultMap type="Onlinecls" id="onlineclsMap">
	<result column="yt_no" property="ytNo" />
	<result column="user_no" property="userNo" />
	<result column="yt_title" property="ytTitle" />
	<result column="yt_content" property="ytContent" />
	<result column="yt_addr" property="ytAddr" />
	<result column="yt_reg_dt" property="ytRegDt" />
	<result column="yt_subject" property="ytSubject" />
	<result column="yt_view_cnt" property="ytViewCnt" />
	<result column="yt_like_cnt" property="ytLike" />
</resultMap>
<!-- 댓글 맵 resultMap -->
<resultMap type="Comment" id="cmtMap">
	<result column="CMT_NO" property="cmtNo" />
	<result column="USER_NO" property="userNo" />
	<result column="BOARD_POST_NO" property="boardPostNo" />
	<result column="CMT_CONTENT" property="cmtContent" />
	<result column="CMT_REG_DT" property="cmtRegDt" />
	<result column="CODE_VALUE" property="codeValue" />
</resultMap>
<!-- 온라인강의 -->
<!-- 회원번호로 조인해 회원아이디 조회 -->
<select id="selectUserId" parameterType="int" resultType="String" flushCache="true" useCache="true">
	select (select user_id from tb_user u
			 where y.user_no = u.user_no) as user_id
	  from tb_youtube y
	 where yt_no = #{ytNo}
</select>
<!-- 온라인강의 과목 리스트 조회 -->
<select id="selectOnlineclsSubject" resultMap="onlineclsMap" flushCache="true" useCache="true">
	select max(yt_subject) as yt_subject, max(yt_addr) as yt_addr 
	  from tb_youtube 
	 group by yt_subject
</select>
<!-- 온라인강의 리스트 조회 -->	
<select id="seletOnlinecls" resultMap="onlineclsMap" parameterType="string" flushCache="true" useCache="true">
	select * 
	  from tb_youtube
	 where yt_subject = #{ytSubject}
</select>

<!-- 온라인강의 상세 -->	
<select id="selectOneOnlinecls" resultMap="onlineclsMap" parameterType="int" flushCache="true" useCache="true">
	select *
	  from tb_youtube
	 where yt_no = #{ytNo}
</select>

<!-- 온라인강의 추가 -->	
<insert id="insertOnlinecls" parameterType="Onlinecls">
	insert into tb_youtube(
		yt_no, user_no, yt_title, yt_content, yt_addr, yt_subject
	) values (
		tb_youtube_seq.nextval, #{userNo}, #{ytTitle}, #{ytContent}, #{ytAddr}, #{ytSubject} 
	)
</insert>

<!-- 온라인강의 수정 -->	
<update id="updateOnlinecls" parameterType="Onlinecls">
	update tb_youtube
	   set yt_title = #{ytTitle},
	       yt_content = #{ytContent},
	       yt_addr = #{ytAddr}
	 where yt_no = #{ytNo}
</update>

<!-- 온라인강의 삭제 -->	
<delete id="deleteOnlinecls" parameterType="int">
	delete
	  from tb_youtube
	 where yt_no = #{ytNo}
</delete>
<!-- // 온라인강의 -->

<!-- 댓글 -->
<!-- 댓글 작성자 조회 -->
<select id="selectCmtUserId" parameterType="int" resultType="String" flushCache="true" useCache="true">
	select (select user_id from tb_user u
			 where c.user_no = u.user_no) as user_id
	  from tb_comment c
	 where BOARD_POST_NO = #{no} and CODE_VALUE = (select code_value from tb_codenm where code_name='온라인강의게시판')
	 order by cmt_no desc
</select>
<!-- 전체 댓글 리스트 조회 -->
<select id="selectComment" resultMap="cmtMap" parameterType="int" flushCache="true" useCache="true">
	select * 
	  from tb_comment
	 where BOARD_POST_NO = #{ytNo} and CODE_VALUE = (select code_value from tb_codenm where code_name='온라인강의게시판')
	 order by cmt_no desc
</select>
<insert id="insertComment" parameterType="Comment">
	insert into tb_comment (
		cmt_no, user_no, board_post_no, cmt_content, code_value
	) values (
		tb_comment_seq.nextval, #{userNo}, #{boardPostNo}, #{cmtContent}, (select code_value from tb_codenm where code_name='온라인강의게시판')
	)
</insert>
	
<!-- // 댓글 -->
</mapper>
<!--
검색은
select * 
  from tb_youtube
 where title = '%' ||#{title}|| '%'
  

 -->
 